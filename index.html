
<!DOCTYPE HTML>

  <html>
    
    <head>
      <meta charset="utf-8">
      <title>Wrong Way</title>
      <meta name="author" content="Gabriel PoÃ§a">

      
      <meta name="description" content="Nov 26th, 2014 Comments Offline Web Apps With Meteor This blog post was written for Group Buddies Blog. In this blog post I&rsquo;m presenting a &hellip;">
      

      <!-- http://t.co/dKP3o1e -->
      <meta name="HandheldFriendly" content="True">
      <meta name="MobileOptimized" content="320">
      <meta name="viewport" content="width=device-width, initial-scale=1">

      <link href="/atom.xml" rel="alternate" title="Wrong Way" type="application/atom+xml">
      
      <link rel="canonical" href="http://gabrielpoca.com/">
      <link href="/favicon.ico" rel="shortcut icon">
      <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
      <link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
      <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
      
      
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', '82577395']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


    </head>


<body>
  <div class="container">
    <div class="left-col">
      <div class="intrude-less">
        <header id="header" class="inner"><div class="profilepic">
  <img src="http://www.gravatar.com/avatar/685cd58e0e6dc5b1219027ea22e47d9d?s=160" alt="Profile Picture" style="width: 160px;" />
</div>

<nav id="main-nav"><ul class="main">
    <li><a href="/">Blog</a></li>
    <li><a href="/about">About</a></li>
    <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		
			<a class="twitter" href="http://twitter.com/gabrielgpoca" title="Twitter">Twitter</a>
		
		
			<a class="github" href="https://github.com/gabrielpoca" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		
		
    	
    	
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
      </div>
    </div>	
    <div class="mid-col">
      
      
      
      <div class="mid-col-container">
        <div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
<div class="meta">
  <div class="date">








  


<time datetime="2014-11-26T22:18:55+00:00" data-updated="true" itemprop="datePublished">Nov 26<span>th</span>, 2014</time></div>
  
  
  <span class="comments"><a href="/blog/2014/11/26/offline-web-apps-with-meteor/#disqus_thread">Comments</a></span>
  
</div>
<h1 class="title" itemprop="name"><a href="/blog/2014/11/26/offline-web-apps-with-meteor/" itemprop="url">Offline Web Apps With Meteor</a></h1>
<div class="entry-content" itemprop="articleBody">
  <p>This blog post was written for <a href="http://blog.groupbuddies.com/posts/45-offline-web-apps-with-meteor">Group Buddies Blog</a>.</p>

<p>In this blog post I&rsquo;m presenting a solution to make Meteor apps work completely offline. In fact, Meteor apps already work offline, as long as the user doesn&rsquo;t close the browser.</p>

<p>If you don&rsquo;t know what Meteor is or how it works, I recommend that you take a look at the <a href="http://docs.meteor.com/#/basic/">meteor docs</a> before moving forward.</p>

<p>One of the principles of Meteor is &ldquo;Data on the Wire&rdquo;, i.e., each client receives all assets upon connection, after which only data is sent between the client and the server.</p>

<p>Another principle is &ldquo;Database Everywhere&rdquo;, i.e., each client has a subset of the server database that responds to the same operations with the same api.</p>

<p>When offline, a client has everything needed to keep the app running. This article focuses on how to allow a user to reopen the application, while being offline, after the browser has been closed.</p>

<h1>Persisting assets</h1>

<p>HTML5 made some progress in allowing web applications to be accessible offline. The result of it is the ApplicationCache interface. Since many people don&rsquo;t know, or understand, <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Using_the_application_cache">AppCache</a>, here&rsquo;s how it is defined in MDN (Mozilla Developer Network).</p>

<blockquote><p>Developers can use the Application Cache (AppCache) interface to specify resources that the browser should cache and make available to offline users. Applications that are cached load and work correctly even if users click the refresh button when they are offline.</p></blockquote>

<p>AppCache stores all the application assets and allows a user to open them when there is no internet connection. For more details on AppCache I recommend <a href="http://www.html5rocks.com/en/tutorials/appcache/beginner/">this guide</a>.</p>

<p>To start using AppCache on a Meteor application just add the package:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meteor add appcache</span></code></pre></td></tr></table></div></figure>


<p>Don&rsquo;t worry if the console logs say the app has more that 5 MB ( which is the recommended maximum). When Meteor builds for production it concatenates and minifies the assets. If it&rsquo;s still more that 5 MB maybe you need to exclude some assets from AppCache.</p>

<p>For instance, you can tell AppCache not to save an image:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Meteor.AppCache.config
</span><span class='line'>  onlineOnly: [
</span><span class='line'>    '/bg.png'
</span><span class='line'>    ]</span></code></pre></td></tr></table></div></figure>


<p>The <a href="https://github.com/meteor/meteor/wiki/AppCache">documentation</a> is a good follow up on this topic.</p>

<h1>Persisting data</h1>

<p>The client side database is in-memory. When offline, Meteor will store both the current working database and a list of messages to send to the server on reconnect. There is no (official) way to persist this data to disk, and for this reason the information is lost when the browser is closed.</p>

<p>To overcome this limitation, there is <a href="https://github.com/GroundMeteor/db">GroundDB</a>, a fast and thin layer providing Meteor with offline database and methods, saving them into the <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/API/DOM/Storage#localStorage"><code>localStorage</code></a>.</p>

<p>To start using GroundDB add the package.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meteor add ground:db</span></code></pre></td></tr></table></div></figure>


<p>Now your subscriptions will be available when you&rsquo;re offline. If you&rsquo;re using IronRouter you should not use the <code>waitOn</code> feature, since this is going to make the application hold until the server responds. Instead, subscribe to the data you want offline on the application startup. For instance, in the file <code>lib/router.coffee</code> you can have something like the following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>if Meteor.isClient
</span><span class='line'>  subscribed = false
</span><span class='line'>  Tracker.autorun () -&gt;
</span><span class='line'>    if Meteor.user() && !subscribed
</span><span class='line'>      Meteor.subscribe 'users'
</span><span class='line'>      Meteor.subscribe 'trips'
</span><span class='line'>      Meteor.subscribe 'expenses'
</span><span class='line'>      Meteor.subscribe 'notifications'
</span><span class='line'>      subscribed = true</span></code></pre></td></tr></table></div></figure>


<p>This way the data will always be on <code>localStorage</code> when the user goes offline. This also means that you need to care about the amount of information that you save locally.</p>

<p>If you are interested in this topic, this <a href="https://groups.google.com/forum/#!searchin/meteor-talk/minimongo$20offline/meteor-talk/tGto0cCsvXA/dH3uZjEd9y4J">google groups thread</a> is a good follow up.</p>

<h1>Summary</h1>

<p>Making an offline web application requires a different ways of thinking about a solution, and there are many plenty problems to solve. These packages help pushing forward on making offline web applications. Feel free to ask questions, I&rsquo;m not an expert but I&rsquo;ll try my best to answer.</p>

<p>As an example, you can run <a href="https://github.com/groupbuddies/tripl.it.git">tripl.it</a> and see it&rsquo;s source code. It&rsquo;s a mobile application that works offline.</p>

  
  
</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
<div class="meta">
  <div class="date">








  


<time datetime="2014-06-24T00:00:00+01:00" data-updated="true" itemprop="datePublished">Jun 24<span>th</span>, 2014</time></div>
  
  
  <span class="comments"><a href="/blog/2014/06/24/streaming-microphone-from-browser-to-nodejs-no-plugin/#disqus_thread">Comments</a></span>
  
</div>
<h1 class="title" itemprop="name"><a href="/blog/2014/06/24/streaming-microphone-from-browser-to-nodejs-no-plugin/" itemprop="url">Tutorial: HTML Audio Capture Streaming to Node.js (No Browser Extensions)</a></h1>
<div class="entry-content" itemprop="articleBody">
  <p>This blog post was written for <a href="http://blog.groupbuddies.com/posts/39-tutorial-html-audio-capture-streaming-to-node-js-no-browser-extensions">Group Buddies Blog</a>.</p>

<p>I&rsquo;m taking the time to write the tutorial I wish I had some months ago. My task was to set up some user voice recording mechanism in the browser. It should record for about one hour, non-stop, saving to a server. The idea was to use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator.getUserMedia">getUserMedia()</a> API. No browser extensions should be used.</p>

<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator.getUserMedia">getUserMedia()</a> API allows web apps to request access to a media device such as a camera or microphone. It yields raw PCM data.</p>

<h2>Round One</h2>

<p>We approached the task looking for the smallest change that solved the problem. We did it using <a href="https://github.com/muaz-khan/WebRTC-Experiment/tree/master/RecordRTC">RecordRTC</a>. It records the microphone in the browser. When finished, we can upload it to a server through a normal request. Let me show you how it works.</p>

<p>Add the RecordRTC library.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;//www.WebRTC-Experiment.com/RecordRTC.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Request access to the microphone.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">session</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">audio</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">video</span><span class="o">:</span> <span class="kc">false</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">recordRTC</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'><span class="nx">navigator</span><span class="p">.</span><span class="nx">getUserMedia</span><span class="p">(</span><span class="nx">session</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">mediaStream</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">recordRTC</span> <span class="o">=</span> <span class="nx">RecordRTC</span><span class="p">(</span><span class="nx">MediaStream</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">recordRTC</span><span class="p">.</span><span class="nx">startRecording</span><span class="p">();</span>
</span><span class='line'><span class="p">},</span> <span class="nx">onError</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>When finished recording, stop and upload to a server.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">recordRTC</span><span class="p">.</span><span class="nx">stopRecording</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">audioURL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;edition[audio]&#39;</span><span class="p">,</span> <span class="nx">recordRTC</span><span class="p">.</span><span class="nx">getBlob</span><span class="p">())</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;some/path&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">data</span><span class="o">:</span> <span class="nx">formData</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">contentType</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">cache</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">processData</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>The code works, but you shouldn&rsquo;t write code like this, it&rsquo;s just an example.</p>

<h3>Drawbacks</h3>

<p>Audio is recorded in wav format. An one hour recording, with one channel, can take around 500mb. This is a problem for the browser limited memory. Also the upload would take ages! It wasn&rsquo;t working.</p>

<h2>Round Two</h2>

<p>After reading the source code from <a href="https://github.com/muaz-khan/WebRTC-Experiment/tree/master/RecordRTC">RecordRTC</a> (ugly) and <a href="https://github.com/mattdiamond/Recorderjs">RecorderJS</a>, I realised that using a <a href="https://developer.mozilla.org/en-US/docs/Web/API/ScriptProcessorNode">ScriptProcessorNode</a> I can write JavaScript to send data chunks (audio samples) from the microphone to a server.</p>

<p>Turns out it&rsquo;s harder than it seems, mostly because of the lack of information. There are a couple of related Stack Overflow answers (I will add them in the end), but I won&rsquo;t bother you with this. Let&rsquo;s move on to the code.</p>

<h3>Reading data from the microphone</h3>

<p>First request microphone access.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">session</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">audio</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">video</span><span class="o">:</span> <span class="kc">false</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">recordRTC</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'><span class="nx">navigator</span><span class="p">.</span><span class="nx">getUserMedia</span><span class="p">(</span><span class="nx">session</span><span class="p">,</span> <span class="nx">initializeRecorder</span><span class="p">,</span> <span class="nx">onError</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Having the microphone stream you can use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioContext">AudioContext</a> interface to make the audio (PCM data) go through different processing nodes before reaching its destination. There are nodes for gain, compressor, panner, and much more. We are going to write a custom node, so we can access the audio samples. For that we add a <a href="https://developer.mozilla.org/en-US/docs/Web/API/ScriptProcessorNode">ScriptProcessorNode</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">initializeRecorder</span><span class="p">(</span><span class="nx">stream</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">audioContext</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">AudioContext</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">audioContext</span><span class="p">();</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">audioInput</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">createMediaStreamSource</span><span class="p">(</span><span class="nx">stream</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">bufferSize</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// create a javascript node</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">recorder</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">createJavaScriptNode</span><span class="p">(</span><span class="nx">bufferSize</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// specify the processing function</span>
</span><span class='line'>  <span class="nx">recorder</span><span class="p">.</span><span class="nx">onaudioprocess</span> <span class="o">=</span> <span class="nx">recorderProcess</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// connect stream to our recorder</span>
</span><span class='line'>  <span class="nx">audioInput</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">recorder</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// connect our recorder to the previous destination</span>
</span><span class='line'>  <span class="nx">recorder</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">destination</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>After this, every audio sample will go through the <code>recorderProcess</code> function.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">recorderProcess</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">inputBuffer</span><span class="p">.</span><span class="nx">getChannelData</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We have now PCM data samples from the left channel. Since we are recording in mono we only need the left channel. Now moving on to streaming these chunks to the server.</p>

<h3>Communication</h3>

<p>We are using WebSockets to send the samples to the server. The server is going to be written in Node.js.</p>

<p>I started with <a href="http://socket.io/">Socket.IO</a>. When things didn&rsquo;t work I realised Socket.IO doesn&rsquo;t support binary communication (in fact, it does now, I made this before it did). <a href="http://binaryjs.com/">BinaryJS</a> does support binary communication, so I moved to it.</p>

<h4>Setup BinaryJS</h4>

<p>First add the BinaryJS library.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://cdn.binaryjs.com/0/binary.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now start a connection.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BinaryClient</span><span class="p">(</span><span class="s1">&#39;ws://localhost:9001&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>When ready, create a write stream.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// for the sake of this example let&#39;s put the stream in the window</span>
</span><span class='line'>  <span class="nb">window</span><span class="p">.</span><span class="nx">Stream</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">createStream</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Going back to our custom node let&rsquo;s send the audio to the stream.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">recorderProcess</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">inputBuffer</span><span class="p">.</span><span class="nx">getChannelData</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">window</span><span class="p">.</span><span class="nx">Stream</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">left</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Everything should be ready on the client side now. Our <code>recorderProcess</code> function is called for each audio chunk, and each is sent to the server.</p>

<p>But we aren&rsquo;t ready yet! There is one important step missing. WebAudio samples are in Float32. If you choose to send them like this you need to know that <a href="https://developer.mozilla.org/en-US/docs/Web/API/Uint16Array">endianness does matter</a>. I chose to convert them to 16 bit signed integers:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">convertFloat32ToInt16</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">l</span> <span class="o">=</span> <span class="nx">buffer</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Int16Array</span><span class="p">(</span><span class="nx">l</span><span class="p">);</span>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="nx">l</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">buf</span><span class="p">[</span><span class="nx">l</span><span class="p">]</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">buffer</span><span class="p">[</span><span class="nx">l</span><span class="p">])</span><span class="o">*</span><span class="mh">0x7FFF</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">buf</span><span class="p">.</span><span class="nx">buffer</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">recorderProcess</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">inputBuffer</span><span class="p">.</span><span class="nx">getChannelData</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">window</span><span class="p">.</span><span class="nx">Stream</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">convertFloat32ToInt16</span><span class="p">(</span><span class="nx">left</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We are now done with the client code. Moving on to the server.</p>

<h3>Setting up a server</h3>

<p>I&rsquo;m not getting into much detail on the server, I&rsquo;m just going to show how to put these chunks in a playable media file. I&rsquo;m assuming you already have <a href="http://nodejs.org/">Node.js</a> installed.</p>

<p>We need <a href="http://binaryjs.com/">BinaryJS</a>, and <a href="https://github.com/TooTallNate/node-wav">node-wav</a> on the server. The first is for communication, and the second accepts raw audio data and outputs a WAV file with a valid WAVE header.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>npm init
</span><span class='line'>npm install binaryjs
</span><span class='line'>npm install wav
</span></code></pre></td></tr></table></div></figure>


<p>Now create the <code>index.js</code> file and start the BinaryJS server.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">binaryServer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;binaryjs&#39;</span><span class="p">).</span><span class="nx">BinaryServer</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">wav</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;wav&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">binaryServer</span><span class="p">({</span><span class="nx">port</span><span class="o">:</span> <span class="mi">9001</span><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">client</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="p">...</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Inside the <code>server.on('connection', function)</code> callback node-wav is going to help pipe the stream into a file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">fileWriter</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;stream&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="nx">meta</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">fileWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">wav</span><span class="p">.</span><span class="nx">FileWriter</span><span class="p">(</span><span class="s1">&#39;demo.wav&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">channels</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">sampleRate</span><span class="o">:</span> <span class="mi">48000</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">bitDepth</span><span class="o">:</span> <span class="mi">16</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="nx">stream</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">fileWriter</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">fileWriter</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">fileWriter</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">fileWriter</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>For a better understanding you should read <a href="https://github.com/TooTallNate/node-wav">node-wav</a> document. In fact, you should read the source code since there isn&rsquo;t much documentation. Simply put, <code>wav.FileWriter</code> accepts a pcm stream and sends it to a media file, setting the right header for the file.</p>

<p>Notice the settings for <code>wav.FileWriter</code> are hardcoded, but they can be sent through the stream. Parameters like sample rate change for each client.</p>

<h2>Setup complete</h2>

<p>You are ready to start recording. There is still a long way to go from here. You should probably support restoring the connection if it goes down, and append the audio to the same media.</p>

<h1>Wrap it up</h1>

<p>You can now start from here and build your own platform with audio recording. Maybe a personal note-taking platform.</p>

<p>This solution allows you to record the microphone while not worrying about upload time and audio loss. The full source code is <a href="https://github.com/gabrielpoca/browser-pcm-stream">here</a>. Feel free to leave any questions and comments.</p>

<h3>StackOverflow related answers</h3>

<ul>
<li><a href="http://stackoverflow.com/questions/21079972/sound-card-detection-for-web/21080953#21080953">Sound card detection for web</a></li>
<li><a href="http://stackoverflow.com/questions/20876152/playing-pcm-stream-from-web-audio-api-on-node-js">Playing PCM stream from Web Audio API on Node.js</a></li>
<li><a href="http://stackoverflow.com/questions/20850396/stream-recorded-audio-from-browser-to-server">Stream recorded audio from browser to server</a></li>
</ul>


  
  
</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
<div class="meta">
  <div class="date">








  


<time datetime="2014-06-04T00:07:39+01:00" data-updated="true" itemprop="datePublished">Jun 4<span>th</span>, 2014</time></div>
  
  
  <span class="comments"><a href="/blog/2014/06/04/dipping-the-toes-in-phonegap/#disqus_thread">Comments</a></span>
  
</div>
<h1 class="title" itemprop="name"><a href="/blog/2014/06/04/dipping-the-toes-in-phonegap/" itemprop="url">Dipping the Toes in Phonegap</a></h1>
<div class="entry-content" itemprop="articleBody">
  <p>This blog post was written for <a href="http://blog.groupbuddies.com/posts/35-dipping-the-toes-in-phonegap">Group Buddies Blog</a>.</p>

<p>Like most developers I know, there is a list of things I want to learn and experiment with. Mobile development was on the top of that list until last December, when we took a day off for an internal hackathon and some of us got to work on a mobile app.</p>

<p><img src="https://dl.dropboxusercontent.com/u/4056020/phonegap/working.jpg" alt="Team Tripl.it" /></p>

<h2>First big decision: Why PhoneGap?</h2>

<p>There is plenty technology available for mobile development. You can go native or you can grab some framework. We chose PhoneGap for a few reasons:</p>

<ol>
<li>It&rsquo;s open source.</li>
<li>It&rsquo;s multi-platform. Even though we ended up focusing on iOS, we didn&rsquo;t have a plan at first (more on this subject ahead).</li>
<li>It&rsquo;s HTML, CSS and JavaScript. We eat this for breakfast, how hard could it be?</li>
<li>I didn&rsquo;t want to look at Objective-C, it hurts my eyes.</li>
<li>PhoneGap is getting more and more popular.</li>
</ol>


<p>For those who don&rsquo;t know, PhoneGap is an application framework that enables you to build native applications using HTML and JavaScript. It uses a web view to run your app, and you can then use Javascript to access underlying operating system features.</p>

<p>It allows you to develop without worrying about the platform. On the other hand you need to worry about the device&rsquo;s native browser since they are all different. It&rsquo;s just like your day to day web development.</p>

<h2>What did we do?</h2>

<p>Tripl.it is a mashup between two words: Trip + Split. It tries to solve the pain of splitting expenses on a trip with friends. We made it simple: we needed to add trips, add friends to a trip, and add friends expenses on the trip. In the end, it would generate a report with who owes what to whom on the trip and to share it by email.</p>

<p>The following image shows the user interfaces, ordered in the intended user flow.</p>

<p><img src="https://dl.dropboxusercontent.com/u/4056020/phonegap/first-flow.png" alt="Hackathon design" /></p>

<p>We got stuck for a while trying to deploy to our devices, but by the end of the day we got some basic functionality and colours. It tasted like success.</p>

<h2>What did we learn?</h2>

<p>It didn&rsquo;t feel like work. Everyone got to learn from technology to user experience and design. But the most important things we learned was that we could do it, we could jump in to (simple) mobile apps.</p>

<h2>Technical Details</h2>

<p>Although it is HTML and CSS the app must have a native &lsquo;feel&rsquo;, with animations, like a slide, between pages. We wanted to do a single page app, and for that job, we used Backbone. We could have also used AngularJS or EmberJS. For storage, there are the browser&rsquo;s databases: WebSQL and localstorage. We used a <a href="https://github.com/MarrLiss/backbone-websql">backbone plugin</a> for websql.</p>

<p>We also used a <a href="https://github.com/hypermurea/generator-phonegap">yeoman generator</a> to get an initial project structure. The package <a href="https://github.com/gruntjs/grunt-contrib-connect">grunt-contrib-connect</a> made it simple to develop on Chrome. It&rsquo;s an HTML app and it runs on every browser that supports websql (not Firefox).</p>

<h2>The following weeks</h2>

<p>In the following weeks I kept working on Tripl.it. I struggled with backbone and websql, with device bugs and with the PhoneGap API.</p>

<p>At some point I got a prototype ready and asked some friends to try it out. This was when we realised that the usability was just wrong. Take a look at the following images, it&rsquo;s the design of this first prototype.</p>

<p><img src="https://dl.dropboxusercontent.com/u/4056020/phonegap/Flow.png" alt="" /></p>

<p>Turns out mobile apps have nothing to do with web apps.</p>

<h3>Icons weren&rsquo;t self-explanatory</h3>

<p>The buttons have no text, they&rsquo;re images. The problem with this is that the images need to clearly communicate what the button does. After you create a trip on Tripl.it you were presented with the following page.</p>

<p><img src="https://dl.dropboxusercontent.com/u/4056020/phonegap/old-timeline.png" alt="" /></p>

<p>What do you think the money button does? And the green button on the top right corner? Is it a confirmation of some kind?</p>

<p>What action would you take next?</p>

<p>The money button would take you to a page where you saw how much each person had. The green button on the top was to show who owes what to whom. And the action you should take next is to add an expense, by clicking the big green button with a &lsquo;plus&rsquo; sign. You probably couldn&rsquo;t figure this out at first, most people couldn&rsquo;t, which made it our fault. Now take a look at what we did next.</p>

<p><img src="https://dl.dropboxusercontent.com/u/4056020/phonegap/last-main.png" alt="" /></p>

<p>We removed the button from top right corner, it is now the report on the bottom right. Seeing how much everyone spent was merged into a view to manage friends, with a link on the bottom left. There are also some other minor improvements.</p>

<p>There is one button less on the page and no button on the top, so you don&rsquo;t get confused about clicking there or on the big green, which represents the next action. We couldn&rsquo;t figure this out without the users feedback and seeing them actually use it.</p>

<h3>Hard-to-click buttons</h3>

<p>You are precise with a mouse, but on a touch screen things are different. Small buttons are hard to hit with a finger. We would see people desperately hitting the back button saying it didn&rsquo;t work.</p>

<p>The buttons are images. To make the buttons work we increased the button size but keep the images the same size, so buttons still look small but are easier to hit since they take invisible space around the image (native apps need to do this too).</p>

<p>Also, since there is no visual feedback on the button being clicked (like changing the color), users would just keep hitting the buttons, even when the action was already in progress.</p>

<h3>Action feedback</h3>

<p>If their device is old, users may tolerate a slow app, but if they have a &ldquo;latest generation something&rdquo; they won&rsquo;t. Loading all the phone&rsquo;s contacts was a pain, I couldn&rsquo;t use a native contact picker, so I was loading all the contacts on the fly through the contacts API. It was incredibly slow. At this point we had two options:</p>

<ol>
<li><p>Load the contacts once and store them in localstorage for later use (it would be a problem to detect new contacts on the device).</p></li>
<li><p>Don&rsquo;t load all the contacts, just give people a search input and start loading with a filter of two or three characters (the contacts API accepts a filter).</p></li>
</ol>


<p>The second option worked really well. People would be presented with an input and after they type the second character it would show the contacts immediately.</p>

<h3>Conventions</h3>

<p>Android and iOS users expect different conventions. iOS users expect to swipe items on a list to get more options, while Android users may expect long presses to do the trick. Our Android testers where just hitting everything attempting to find some more options. Some of them found the swipe by accident, but most of them never did.</p>

<h3>Animations</h3>

<p>There are just two animations on Tripl.it and both are slides. One for changing the page, which slides left and right, and one on the lists, where some options appear. This is accomplished with hardware accelerated translations.</p>

<p>You can use hardware accelerated effects (like slide, rotate and scale) as much as you want. But we wanted things changing opacity and color, and that is really slow since there is no hardware acceleration for it. That&rsquo;s very limiting in comparison with native apps, and even with desktop browsers. Of course there is the HTML canvas, but that&rsquo;s a different story.</p>

<p>If you install Tripl.it you&rsquo;ll notice the lists don&rsquo;t have rounded border-radius like on the images. The reason for that is a bug on webkit browsers. When something is sliding (the hidden menu you slide left to show) it ignores it&rsquo;s overflow (which is the list). We had to remove the border-radius so we could keep the animation.</p>

<h3>Others</h3>

<p>The list goes on and on. We changed both the views and the flow. We moved primary actions to the top right navigation and dismantled complex views with many buttons.</p>

<p><img src="https://dl.dropboxusercontent.com/u/4056020/phonegap/flow-last.png" alt="" /></p>

<p>The previous image contains the current design. There&rsquo;s still a long way to go but our understanding of mobile improved immensely.</p>

<h2>Conclusion</h2>

<p>We designed the app to make it work for both Android and iOS. We underestimated the different conventions/patterns for each platform. Looking back, we probably should have focused on one platform or treat them as different apps. It is a clear mistake, and PhoneGap being multi platform was not a major benefit as we first thought.</p>

<p>PhoneGap has the obvious limitations of web vs native apps. Mobile browsers don&rsquo;t support effects like blur, some types of animation are slow and if you want to support older versions of android it gets even worse. JoÃ£o suggested some animations he saw on other apps and we couldn&rsquo;t use most of them because they&rsquo;d look &lsquo;laggy&rsquo;.</p>

<p>Since it wasn&rsquo;t supposed to be a fancy app, and it should have been fast to do, PhoneGap was indeed the right tool for the job. I&rsquo;ll definitely use it again for small apps or prototyping. Maybe combining it with AngularJS or EmberJS should be interesting. There are some interesting <a href="http://phonegap.com/app/">apps built with PhoneGap</a>. If you are a web developer looking to build a mobile app for your product, you should give it a try. You&rsquo;ll probably reutilize a lot of code.</p>

<p>If you&rsquo;re just looking to download the app, click <a href="http://www.tripl.it/">here</a>. Don&rsquo;t forget to leave feedback.</p>

  
  
</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
<div class="meta">
  <div class="date">








  


<time datetime="2013-12-03T00:52:00+00:00" data-updated="true" itemprop="datePublished">Dec 3<span>rd</span>, 2013</time></div>
  
  
  <span class="comments"><a href="/blog/2013/12/03/playing-with-google-apps-script/#disqus_thread">Comments</a></span>
  
</div>
<h1 class="title" itemprop="name"><a href="/blog/2013/12/03/playing-with-google-apps-script/" itemprop="url">Playing With Google Apps Script</a></h1>
<div class="entry-content" itemprop="articleBody">
  <p>I wrote a google apps script for a spreadsheet.
I&rsquo;ve never done it before and I hope not to to do it again.</p>

<p>The reason I&rsquo;ve wrote it was to automate some tasks on my dad&rsquo;s budget spreadsheet:</p>

<ul>
<li>Create a new row in a given place with a given formula.</li>
<li>Duplicate a document used as template.</li>
</ul>


<h2>Insert a row</h2>

<p>I created a template row and made it hidden. Then my function uses it to create
a new one and place it in the right place. Everything gets copied,
including the formulas.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">newLine</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">spreadsheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActiveSpreadsheet</span><span class="p">();</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="nx">spreadsheet</span><span class="p">.</span><span class="nx">getActiveSheet</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">sheet</span><span class="p">.</span><span class="nx">insertRowsAfter</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">sheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="s2">&quot;A10:F10&quot;</span><span class="p">).</span><span class="nx">copyTo</span><span class="p">(</span><span class="nx">sheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="s2">&quot;A11:F11&quot;</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Create a new document</h2>

<p>I created a default document to be used as a template for all budgets.
Then I need a function to duplicate that document (teaching my dad
wasn&rsquo;t working).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">newSheet</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">spreadsheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActiveSpreadsheet</span><span class="p">();</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="nx">spreadsheet</span><span class="p">.</span><span class="nx">getSheetByName</span><span class="p">(</span><span class="s1">&#39;Default&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">sheet</span><span class="p">.</span><span class="nx">copyTo</span><span class="p">(</span><span class="nx">spreadsheet</span><span class="p">).</span><span class="nx">setName</span><span class="p">(</span><span class="s2">&quot;Novo orÃ§amento&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Wrap it up</h2>

<p>I made both functions available on the top menu, as seen in the image</p>

<p><img src="/images/2013/12/google-apps-print.png" alt="google-apps-pring" /></p>

<p>And the full script</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">newLine</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">spreadsheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActiveSpreadsheet</span><span class="p">();</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="nx">spreadsheet</span><span class="p">.</span><span class="nx">getActiveSheet</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">sheet</span><span class="p">.</span><span class="nx">insertRowsAfter</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">sheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="s2">&quot;A10:F10&quot;</span><span class="p">).</span><span class="nx">copyTo</span><span class="p">(</span><span class="nx">sheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="s2">&quot;A11:F11&quot;</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">newSheet</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">spreadsheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActiveSpreadsheet</span><span class="p">();</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="nx">spreadsheet</span><span class="p">.</span><span class="nx">getSheetByName</span><span class="p">(</span><span class="s1">&#39;Default&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">sheet</span><span class="p">.</span><span class="nx">copyTo</span><span class="p">(</span><span class="nx">spreadsheet</span><span class="p">).</span><span class="nx">setName</span><span class="p">(</span><span class="s2">&quot;Novo orÃ§amento&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// The onOpen function is executed automatically every time a Spreadsheet is loaded</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">onOpen</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">ss</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActiveSpreadsheet</span><span class="p">();</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">menuEntries</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">menuEntries</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Novo orÃ§amento&quot;</span><span class="p">,</span> <span class="nx">functionName</span><span class="o">:</span> <span class="s2">&quot;newSheet&quot;</span><span class="p">});</span>
</span><span class='line'>  <span class="nx">menuEntries</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">menuEntries</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Adicionar novo produto&quot;</span><span class="p">,</span> <span class="nx">functionName</span><span class="o">:</span> <span class="s2">&quot;newLine&quot;</span><span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">ss</span><span class="p">.</span><span class="nx">addMenu</span><span class="p">(</span><span class="s2">&quot;OrÃ§amento&quot;</span><span class="p">,</span> <span class="nx">menuEntries</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>It took a whole morning.</p>

  
  
</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
<div class="meta">
  <div class="date">








  


<time datetime="2013-08-10T16:56:00+01:00" data-updated="true" itemprop="datePublished">Aug 10<span>th</span>, 2013</time></div>
  
  
  <span class="comments"><a href="/blog/2013/08/10/jekyll-nginx-capistrano/#disqus_thread">Comments</a></span>
  
</div>
<h1 class="title" itemprop="name"><a href="/blog/2013/08/10/jekyll-nginx-capistrano/" itemprop="url">Jekyll, Nginx and Capistrano</a></h1>
<div class="entry-content" itemprop="articleBody">
  <p>Yes, I&rsquo;m blogging about blogging again. I&rsquo;ve just updated this blog so I&rsquo;m writing about it. Mostly I will tell you about my jekyll setup.</p>

<p>I&rsquo;m running a <a href="http://nginx.org/">nginx</a> server. I use github to store my code. I&rsquo;ve setup <a href="https://github.com/capistrano/capistrano">capistrano</a> for automatic deploys. Everything else is jekyll.</p>

<p><strong>How it works</strong>: I update my blog. I push to github. I type <code>cap deploy</code>. The code on the server is updated from github. It runs bundle install if needed on the server. It compiles jekyll and it&rsquo;s done.</p>

<h2>Theme</h2>

<p>I made it from scratch with html and sass (using compass and foundation like I always do). It was easy since I&rsquo;m probably what you can call a web developer. Now I have a simple and organized theme to change when ever I want.</p>

<p>The tricky part was to setup sass. People normally run the <code>compass --watch</code> stuff to compile sass to a folder that jekyll loads. You start compass, you start jekyll and it&rsquo;s fine. You can even use Foreman to make it easier. There are two problems:</p>

<p>To use images in css I had to write they&rsquo;re full path. That&rsquo;s not god. The solution was to make jekyll process css, but since css was generated from sass there were all kind of syntax problems.</p>

<p>My solution was to use <code>gem "jekyll-assets"</code>. It&rsquo;s gives you the same as rails asset pipeline. This solved my problems.</p>

<p>Also I had to put the following code in a file on the plugins folder for sass compiler to load compass. This was a hard to find solution.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Compass</span><span class="o">.</span><span class="n">sass_engine_options</span><span class="o">[</span><span class="ss">:load_paths</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span>
</span><span class='line'>  <span class="no">Sass</span><span class="o">.</span><span class="n">load_paths</span> <span class="o">&lt;&lt;</span> <span class="n">path</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Tasks</h2>

<p>There is probably only one thing I like in octopress: <strong>Rakefile</strong>. I used some of their code to make my life easy. The rest I got searching or writing myself.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;rubygems&quot;</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;bundler/setup&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">posts_dir</span> <span class="o">=</span> <span class="s2">&quot;_posts&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">desc</span> <span class="s1">&#39;Run the jekyll server&#39;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:server</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">system</span> <span class="s2">&quot;jekyll serve -w&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">desc</span> <span class="s1">&#39;Run the jekyll dev server with drafts&#39;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:preview</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">system</span> <span class="s2">&quot;jekyll serve -w --drafts&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">namespace</span> <span class="ss">:jekyll</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">desc</span> <span class="s1">&#39;Delete generated _site files&#39;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:clean</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">system</span> <span class="s2">&quot;rm -fR _site&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">desc</span> <span class="s1">&#39;Clean temporary files and run the server&#39;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:compile</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:clean</span><span class="o">]</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">system</span> <span class="s2">&quot;jekyll build&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1"># usage rake new_post[my-new-post] or rake new_post[&#39;my new post&#39;] or rake new_post (defaults to &quot;new-post&quot;)</span>
</span><span class='line'><span class="n">desc</span> <span class="s2">&quot;Begin a new post in </span><span class="si">#{</span><span class="n">posts_dir</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:new_post</span><span class="p">,</span> <span class="ss">:title</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="nb">print</span> <span class="s2">&quot;Enter a title for your post: &quot;</span>
</span><span class='line'>    <span class="n">title</span> <span class="o">=</span> <span class="no">STDIN</span><span class="o">.</span><span class="n">gets</span><span class="o">.</span><span class="n">chomp</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">mkdir_p</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">posts_dir</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">posts_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="n">title</span><span class="o">.</span><span class="n">to_url</span><span class="si">}</span><span class="s2">.md&quot;</span>
</span><span class='line'>  <span class="k">if</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span class='line'>    <span class="nb">abort</span><span class="p">(</span><span class="s2">&quot;rake aborted!&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">ask</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> already exists. Do you want to overwrite?&quot;</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="o">]</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;Creating new post: </span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;---&quot;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;layout: post&quot;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;title: </span><span class="se">\&quot;</span><span class="si">#{</span><span class="n">title</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/&amp;/</span><span class="p">,</span><span class="s1">&#39;&amp;amp;&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;date: </span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d %H:%M&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;---&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Deploy</h2>

<p>To deploy I just run <code>cap deploy</code>. Everything else <a href="https://github.com/capistrano/capistrano">capistrano</a> takes care of.</p>

<p>I need two gems for this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;capistrano&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;rvm-capistrano&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And the following code is my <em>deploy.rb</em> file. Notice the <code>require "rvm/capistrano"</code> it is needed if you use rvm.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;rvm/capistrano&quot;</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;bundler/capistrano&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="ss">:user</span><span class="p">,</span> <span class="s1">&#39;USERNAME&#39;</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:deploy_to</span><span class="p">,</span> <span class="s2">&quot;SERVER FOLDER TO DEPLOY TO&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:use_sudo</span><span class="p">,</span> <span class="kp">false</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="ss">:application</span><span class="p">,</span> <span class="s2">&quot;APPLICATION NAME&quot;</span>
</span><span class='line'><span class="n">server</span> <span class="s2">&quot;SERVER_NAME&quot;</span><span class="p">,</span> <span class="ss">:app</span><span class="p">,</span> <span class="ss">:web</span><span class="p">,</span> <span class="ss">:db</span><span class="p">,</span> <span class="ss">:primary</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'><span class="n">ssh_options</span><span class="o">[</span><span class="ss">:forward_agent</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:bundle_flags</span><span class="p">,</span> <span class="s2">&quot;--deployment&quot;</span>
</span><span class='line'><span class="n">ssh_options</span><span class="o">[</span><span class="ss">:keys</span><span class="o">]</span> <span class="o">=</span> <span class="sx">%w(PATH TO SSH KEY)</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:scm</span><span class="p">,</span> <span class="s1">&#39;git&#39;</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:repository</span><span class="p">,</span>  <span class="s2">&quot;REPOSITORY URL&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:branch</span><span class="p">,</span> <span class="s1">&#39;master&#39;</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:deploy_via</span><span class="p">,</span> <span class="ss">:remote_cache</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:keep_releases</span><span class="p">,</span> <span class="mi">5</span>
</span><span class='line'>
</span><span class='line'><span class="n">namespace</span> <span class="ss">:deploy</span> <span class="k">do</span>
</span><span class='line'>  <span class="o">[</span><span class="ss">:start</span><span class="p">,</span> <span class="ss">:stop</span><span class="p">,</span> <span class="ss">:restart</span><span class="p">,</span> <span class="ss">:finalize_update</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>    <span class="n">desc</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">t</span><span class="si">}</span><span class="s2"> task is a no-op with jekyll&quot;</span>
</span><span class='line'>    <span class="n">task</span> <span class="n">t</span><span class="p">,</span> <span class="ss">:roles</span> <span class="o">=&gt;</span> <span class="ss">:app</span> <span class="k">do</span> <span class="p">;</span> <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># compile compass and then jekyll</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:finalize_update</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">run</span> <span class="s2">&quot;cd </span><span class="si">#{</span><span class="n">latest_release</span><span class="si">}</span><span class="s2">; rake jekyll:compile&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Problems</h2>

<p>So I was using <a href="http://octopress.org/">Octopress</a> for a while. Not that I write that much, but I try to. The problem with octopress is that it is too much. Seriously, it is too much.</p>

<p>Sass compilation time to slow.</p>

  
  
</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
<div class="meta">
  <div class="date">








  


<time datetime="2012-08-24T00:00:00+01:00" data-updated="true" itemprop="datePublished">Aug 24<span>th</span>, 2012</time></div>
  
  
  <span class="comments"><a href="/blog/2012/08/24/about_codebits_last_year/#disqus_thread">Comments</a></span>
  
</div>
<h1 class="title" itemprop="name"><a href="/blog/2012/08/24/about_codebits_last_year/" itemprop="url">About Codebits Last Year</a></h1>
<div class="entry-content" itemprop="articleBody">
  <p>Last year I attended <a href="https://codebits.eu">codebits</a> for the first time. It was amazing! It&rsquo;s the technology conference you shouldn&rsquo;t miss if you&rsquo;re in Portugal.</p>

<p>It&rsquo;s not a three days straight in front of a computer wearing smelly clothes. It may seem like, it may also be like it, but it is much more. Just remembering the awesome nyan cat moment. The hunt for badges. Stuff to win. O&#8217;Reilly&rsquo;s book at half the price. Many talks and challenges. And strange people, just how I like it.</p>

<p>I came back with a bag full of shirts and great ideas for the next year. Looking forward to see what&rsquo;s new. Beware the tacos!</p>

  
  
</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
<div class="meta">
  <div class="date">








  


<time datetime="2012-07-08T00:00:00+01:00" data-updated="true" itemprop="datePublished">Jul 8<span>th</span>, 2012</time></div>
  
  
  <span class="comments"><a href="/blog/2012/07/08/about_jekyll_and_github_pages_and_plugins/#disqus_thread">Comments</a></span>
  
</div>
<h1 class="title" itemprop="name"><a href="/blog/2012/07/08/about_jekyll_and_github_pages_and_plugins/" itemprop="url">About Jekyll, Github Pages and Plugins</a></h1>
<div class="entry-content" itemprop="articleBody">
  <p>It looks like everyone is talking about jekyll and github pages so I&rsquo;m also going to let my tips around here.</p>

<p>Github pages doesn&rsquo;t allow jekyll pluggins, you may not need them or you may have to find your way around like I did.</p>

<p>I haven&rsquo;t actually found a way around, to use plugins I have to generate my blog before and push it to the repo. The solution is to have a branch with my blog&rsquo;s source files and push the output to the master branch.</p>

<p>I added <em>site</em> to .gitignore and now its magic! I can switch to my source branch, do all the alterations, generate the blog, go back to the master branch and move the files from <em>site</em> to the root folder and push the updated blog.</p>

  
  
</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
<div class="meta">
  <div class="date">








  


<time datetime="2012-05-26T00:00:00+01:00" data-updated="true" itemprop="datePublished">May 26<span>th</span>, 2012</time></div>
  
  
  <span class="comments"><a href="/blog/2012/05/26/macvim-tab-navigation/#disqus_thread">Comments</a></span>
  
</div>
<h1 class="title" itemprop="name"><a href="/blog/2012/05/26/macvim-tab-navigation/" itemprop="url">MacVim Tab Navigation</a></h1>
<div class="entry-content" itemprop="articleBody">
  <p>Very usefull tip I found to have CMD+Number tab navigation in MacVim.</p>

<p>Past the code bellow in vimrc.</p>

<pre><code>if has("gui_macvim")
    map &amp;ltD-1&amp;gt :tabfirst&amp;ltCr&amp;gt
    map &amp;ltD-2&amp;gt :tabfirst&amp;ltCr&amp;gtgt
    map &amp;ltD-3&amp;gt :tabfirst&amp;ltCr&amp;gt3gt
    map &amp;ltD-4&amp;gt :tabfirst&amp;ltCr&amp;gt4gt
    map &amp;ltD-5&amp;gt :tabfirst&amp;ltCr&amp;gt5gt
    map &amp;ltD-6&amp;gt :tabfirst&amp;ltCr&amp;gt6gt
    map &amp;ltD-7&amp;gt :tabfirst&amp;ltCr&amp;gt7gt
    map &amp;ltD-8&amp;gt :tabfirst&amp;ltCr&amp;gt8gt
    map &amp;ltD-9&amp;gt :tabfirst&amp;ltCr&amp;gt9gt
endif
</code></pre>

  
  
</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
<div class="meta">
  <div class="date">








  


<time datetime="2012-04-24T00:00:00+01:00" data-updated="true" itemprop="datePublished">Apr 24<span>th</span>, 2012</time></div>
  
  
  <span class="comments"><a href="/blog/2012/04/24/magnet-links-and-rtorrent/#disqus_thread">Comments</a></span>
  
</div>
<h1 class="title" itemprop="name"><a href="/blog/2012/04/24/magnet-links-and-rtorrent/" itemprop="url">Magnet Links and Rtorrent</a></h1>
<div class="entry-content" itemprop="articleBody">
  <p>There seems to bem some confusion about magnet links in <a href="http://libtorrent.rakshasa.no">rtorrent</a>.</p>

<p>It works without patch, just type the magnetic link directly:</p>

<pre><code>load.normal&gt; magnet:?xt=urn:btih:cf87cc0d6b0db21d2221694effae3758479ad4d1&amp;dn=Dan+Bull+-+Sharing+Is+Caring+%2B+bonus+tracks&amp;tr=udp%3A%2F%2Ftracker.openbittorrent.com%3A80&amp;tr=udp%3A%2F%2Ftracker.publicbt.com%3A80&amp;tr=udp%3A%2F%2Ftracker.ccc.de%3A80
</code></pre>

<p>I&rsquo;m now finishing a ruby script to download from piratebay and send to rtorrent.</p>

<p>To install rtorrent with MacPorts just run:</p>

<pre>
sudo port install libtorrent
sudo port install rtorrent
</pre>




  
  
</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
<div class="meta">
  <div class="date">








  


<time datetime="2012-04-18T00:00:00+01:00" data-updated="true" itemprop="datePublished">Apr 18<span>th</span>, 2012</time></div>
  
  
  <span class="comments"><a href="/blog/2012/04/18/how-to-install-ubuntu-on-a-macbookpro/#disqus_thread">Comments</a></span>
  
</div>
<h1 class="title" itemprop="name"><a href="/blog/2012/04/18/how-to-install-ubuntu-on-a-macbookpro/" itemprop="url">How to Install Ubuntu on a MacbookPro</a></h1>
<div class="entry-content" itemprop="articleBody">
  <p>I wrote about my ubuntu installation on my macbook pro a long time ago but I&rsquo;ve never published because I&rsquo;ve never finished it. Here it is now.</p>

<p>I&rsquo;ve been waiting for a while to try a linux installation on my Macbook Pro. I have now a triple boot with Lion, Windows 7 and Ubuntu (actually is Xubunut now).</p>

<p>I&rsquo;ve just tried it and I&rsquo;m probably never using it again, mostly because the battery, which gives about 3 hours on against about 6 on Lion. About Windows 7 I&rsquo;ve installed it a long time ago. So this are the steps I followed:</p>

<ol>
<li>Install and enable <a href="http://refit.sourceforge.net/">refit</a>.</li>
<li>Download your Ubuntu image and &ldquo;burn&rdquo; it to usb with <a href="http://unetbootin.sourceforge.net">unetbootin</a>.</li>
<li>Reboot with the usb inserted, and chose &ldquo;Partition Tools&rdquo; in refit. It will ask to update the partition table, do it. Then it reboots again.</li>
<li>When it opens again chose to start up from Ubuntu usb (you should see it side with OSX).</li>
<li>Proceed normally with the installation.</li>
</ol>


<p>You should pay attention if it asks to chose the place to install GRUB. In my installation it didn&rsquo;t ask and everything went well, but in arch linux wiki they talk about related problems. Anyway, just don&rsquo;t replace the MBR. I&rsquo;ll try a different distro later, probably <a href="http://crunchbanglinux.org/">crunch bang</a>.</p>

<p>About the working distro: Everything works fine. The trackpad is odd, or different, it doesn&rsquo;t feel like it is supposed to, but I could get use to it. Also there are some minor issues on the keyboard lights (don&rsquo;t know why but when I tried Xubuntu next it was fixed), but nothing really annoying. Just take a look around this <a href="https://help.ubuntu.com/community/MacBookPro8-2/Oneiric">here</a>, or <a href="https://wiki.ubuntu.com/MactelSupportTeam/CommunityHelpPages">here</a> if you&rsquo;re macbook pro isn&rsquo;t from late 2011.</p>

<p>Besides the battery, the wireless really sucks. There are no official drivers and you get to use ndiswrapper with windows drivers or some strange ones I don&rsquo;t really remember the name right now but are listed in those pages I referred to before. Anyhow you get a weak signal and it heats oddly, a lot.</p>

<p>I could probably live with it, but I found my way around with OSX and I like it now.</p>

  
  
</div>

</article>

</div>
<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
      </div>
      <footer id="footer" class="inner">Copyright &copy; 2014

    Gabriel PoÃ§a


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
    </div>
  </div>
  

</body>
</html>
